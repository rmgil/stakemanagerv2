âš ï¸ **Bug-fix e ajustes de lÃ³gica financeira**

Corrigir os cÃ¡lculos de percentagens e lucros/perdas nos seguintes cenÃ¡rios:

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1.  ğŸ”„  Percentagem Polarize vs. Deal Normal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Regra-geral (torneios normais):
cap_normal = level.normal_cap_usd # ex.: 22 $
polarize_pct = max(0, (buyin_usd - cap_normal) / buyin_usd)
normal_pct = 1 - polarize_pct
resultado = prize_usd - buyin_usd
lucro_normal = resultado * normal_pct
lucro_polar = resultado * polarize_pct

markdown
Copy
Edit

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.  ğŸŸ   Phase Day 1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
* **Sempre** trata o buy-in como prejuÃ­zo (resultado = -buyin_usd).  
* Usa **cap_phase** do nÃ­vel (ex.: 11 $) para calcular pct:
cap_phase = level.phase_cap_usd
polarize_pct = max(0, (buyin_usd - cap_phase) / buyin_usd)
normal_pct = 1 - polarize_pct
lucro_normal = (-buyin_usd) * normal_pct # ex.: -11
lucro_polar = (-buyin_usd) * polarize_pct # ex.: -44

markdown
Copy
Edit

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3.  ğŸŸ¢  Phase Day 2 ou superior
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
* Buy-in lÃ³gico = 0 **para o resultado financeiro**  
  (prize nÃ£o Ã© descontado).  
* **Mas** o buy-in real continua a definir as percentagens:
exemplo 55 $ buy-in, cap_phase=11 $
polarize_pct = (55-11)/55 = 0.8
normal_pct = 0.2
resultado = prize_usd # sem deduzir buy-in
lucro_normal = resultado * 0.2
lucro_polar = resultado * 0.8

markdown
Copy
Edit

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4.  ğŸ”µ  Re-entries
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
* Se aparecer â€œYou made X re-entriesâ€, gerar **X + 1 sub-entradas**:
  - Cada sub-entrada herda o mesmo buy-in.  
  - As primeiras X tÃªm prize = 0.  
  - A Ãºltima recebe o prize do ficheiro.  
* Processar **cada sub-entrada individualmente** pela regra do tipo
  (normal ou Phase D1) e depois somar os resultados.  
  > Ex.: Big 20 (20 $, 3 re-entries, nÃ­vel 3.1) â†’ 4 sub-entradas  
  >â€ƒâ€¢ Cada buy-in = 20 $ (< 22 $) â†’ 100 % deal normal  
  >â€ƒâ€¢ Lucro total = 32.7 â€“ 80 = -47.3 $ 100 % deal normal

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.  ğŸ’±  Outras moedas
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
* Manter conversÃ£o pendente; se a taxa ainda nÃ£o estiver definida,
  marca `conversionPending = true` e retorna â€œN/Aâ€ no relatÃ³rio.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.  ğŸ§ª  Testes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
* Adicionar testes unitÃ¡rios que reproduzam EXACTAMENTE os casos abaixo:

| Caso | Tipo | buy-in | prize | re-entries | cap | Esperado |
|------|------|--------|-------|------------|-----|----------|
| A | Phase D1 | 55 | 0 | 0 | 11 | normal -11 / polar -44 |
| B | Phase D2 | 55 | 113.44 | 0 | 11 | normal 22.688 / polar 90.752 |
| C | Normal bounty | 55 | 18.75 | 0 | 22 | normal -14.5 / polar -21.75 |
| D | Normal re-entry | 20 | 32.7 | 3 | 22 | normal -47.3 / polar 0 |
| E | Moeda â‰  USD | Â¥110 | 302.9 | 0 | 22 | conversÃ£o pendente |

(use assert â‰ˆ 0.01 p/ flutuantes).

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
**Implementa SÃ“ estas alteraÃ§Ãµes; UI e endpoints mantÃªm-se.**